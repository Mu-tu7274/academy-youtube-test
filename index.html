<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>YouTube Fetch Flow</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root{
  --bg:#050816;
  --card:#0b0f2a;
  --border:rgba(255,255,255,.15);
  --accent:#ffb347;
  --accent2:#ff6b3d;
  --text:#f5f5f5;
  --muted:#a8a8c0;
}
*{box-sizing:border-box}
body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:system-ui;
}
.shell{
  width:100%;
  max-width:520px;
  background:var(--card);
  border-radius:20px;
  padding:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.7);
}
.hidden{display:none}
.title{text-align:center;font-size:18px;font-weight:600}
.subtitle{text-align:center;font-size:13px;color:var(--muted);margin-bottom:16px}
.btn{
  width:100%;
  border:none;
  border-radius:999px;
  padding:10px;
  margin-top:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}
.btn-secondary{
  background:transparent;
  color:var(--text);
  border:1px solid var(--border);
}
.log{
  margin-top:12px;
  font-size:12px;
  background:#00000040;
  border:1px dashed var(--border);
  border-radius:12px;
  padding:10px;
  max-height:140px;
  overflow:auto;
  white-space:pre-wrap;
}
.loader{
  margin:20px auto;
  width:42px;
  height:42px;
  border-radius:50%;
  border:4px solid #ffffff30;
  border-top-color:var(--accent);
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
pre{
  background:#00000050;
  border-radius:12px;
  padding:10px;
  font-size:12px;
  max-height:280px;
  overflow:auto;
  direction:ltr;
}
</style>
</head>

<body>
<div class="shell">

<!-- PAGE 1 -->
<div id="page1">
  <div class="title">ØªØ´ØºÙŠÙ„ ÙŠÙˆØªÙŠÙˆØ¨ Ù…Ø¹Ù†Ø§</div>
  <div class="subtitle">Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©</div>
  <button id="goPage2" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â–¶</button>
  <div id="log1" class="log"></div>
</div>

<!-- PAGE 2 -->
<div id="page2" class="hidden">
  <div class="title">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>
  <div class="subtitle">ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡</div>

  <button id="openWatch" class="btn">ØªØ´ØºÙŠÙ„ ÙŠÙˆØªÙŠÙˆØ¨ â–¶</button>
  <button id="goFetchPage" class="btn btn-secondary">Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ğŸ“¥</button>
  <button id="back1" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹</button>

  <div id="log2" class="log"></div>
</div>

<!-- PAGE 3 -->
<div id="page3" class="hidden">
  <div class="title">Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</div>
  <div class="subtitle">ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ downr</div>

  <div id="loader" class="loader"></div>

  <pre id="fetchResult" class="hidden"></pre>

  <button id="back2" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹</button>

  <div id="log3" class="log"></div>
</div>

</div>

<script>
(() => {
"use strict";

const YOUTUBE_URL = "https://www.youtube.com/watch?v=m-VVub8Jp_w";
const DOWNR_URL = "https://downr.org/.netlify/functions/download";

const el = id => document.getElementById(id);

function log(msg){
  const page =
    !el("page3").classList.contains("hidden") ? el("log3") :
    !el("page2").classList.contains("hidden") ? el("log2") :
    el("log1");

  page.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
}

function showPage(n){
  ["page1","page2","page3"].forEach(p=>el(p).classList.add("hidden"));
  el("page"+n).classList.remove("hidden");
  log("â¡ï¸ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© " + n);
}

async function fetchDownr(){
  el("loader").classList.remove("hidden");
  el("fetchResult").classList.add("hidden");
  el("fetchResult").textContent = "";

  try{
    log("ğŸ“¡ POST â†’ downr");
    const res = await fetch(DOWNR_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ url:YOUTUBE_URL })
    });

    const text = await res.text();
    let data;
    try{ data = JSON.parse(text); }catch{ data = text; }

    el("loader").classList.add("hidden");
    el("fetchResult").classList.remove("hidden");
    el("fetchResult").textContent =
      JSON.stringify({ status:res.status, data },null,2);

    log("âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");

  }catch(e){
    el("loader").classList.add("hidden");
    el("fetchResult").classList.remove("hidden");
    el("fetchResult").textContent =
      JSON.stringify({ error:e.message || e },null,2);
    log("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙÙŠØªØ´");
  }
}

/* EVENTS */
el("goPage2").onclick = ()=> showPage(2);
el("back1").onclick = ()=> showPage(1);
el("back2").onclick = ()=> showPage(2);

el("openWatch").onclick = ()=>{
  log("ğŸš€ ÙØªØ­ ÙŠÙˆØªÙŠÙˆØ¨");
  window.location.assign(YOUTUBE_URL);
};

el("goFetchPage").onclick = ()=>{
  showPage(3);
  fetchDownr(); // âœ… ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙÙŠØªØ´ ØªÙ„Ù‚Ø§Ø¦ÙŠ
};

})();
</script>

</body>
</html>
